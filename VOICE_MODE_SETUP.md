# Voice Mode Setup Guide

This guide explains how to configure the voice prayer feature for development and production.

## Environment Configuration

Add the following to your `.env.local` file:

```bash
# Voice Mode (test or production)
# test: Uses browser TTS with background music for development
# production: Requires subscription for ElevenLabs TTS
NEXT_PUBLIC_VOICE_MODE=test
```

## Modes

### Test Mode (`NEXT_PUBLIC_VOICE_MODE=test`)

**Purpose:** Development and testing without API costs

**Features:**
- ✅ No subscription required
- ✅ Uses browser's built-in Text-to-Speech (TTS)
- ✅ Random background ambience from `/public/bg` folder
- ✅ Random one-minute prayer text (3 variations)
- ✅ Works for all users (authenticated or guest)

**Behavior:**
- Clicking "Listen to this prayer" button plays audio immediately
- No upgrade modal shown
- Prayer text is randomly selected from 3 pre-written prayers
- Background music is randomly selected from:
  - `Midnight Rain Haze.mp3`
  - `Rain Drift Continuum.mp3`
  - `Tidal Stillness.mp3`

### Production Mode (`NEXT_PUBLIC_VOICE_MODE=production`)

**Purpose:** Live production with premium features

**Features:**
- ✅ Requires premium subscription
- ✅ Uses ElevenLabs API for high-quality TTS
- ✅ Uses OpenRouter LLM for personalized prayer generation
- ✅ Shows upgrade modal for non-premium users

**Behavior:**
- **Non-premium users:** See upgrade modal when clicking "Listen to this prayer"
- **Premium users:** Get ElevenLabs audio with background music
- Prayer text generated by OpenRouter based on user's needs
- Professional voice quality with background ambience

## Premium User Indication

Premium users are indicated in the **Profile tab** with:
- ✨ Sparkle emoji badge on avatar
- Golden ring around avatar
- "✨ Premium Member" text
- Gold crown icon
- Next billing date display

## Testing

### To test in development:

1. Set `NEXT_PUBLIC_VOICE_MODE=test` in `.env.local`
2. Restart your dev server
3. Click "Listen to this prayer" button
4. Should hear browser TTS with background music immediately

### To test production flow:

1. Set `NEXT_PUBLIC_VOICE_MODE=production` in `.env.local`
2. Restart your dev server
3. As non-premium user: Click button → See upgrade modal
4. As premium user: Click button → Hear ElevenLabs audio

## Files Modified

- `src/lib/test-mode.ts` - Test mode utilities
- `components/HomeScreen.tsx` - Voice prayer button logic
- `.env.example` - Environment variable documentation

## API Requirements

### Test Mode
- No API keys required
- Works offline with browser TTS

### Production Mode
- `OPENROUTER_API_KEY` - For prayer text generation
- `ELEVENLABS_API_KEY` - For voice synthesis
- `ELEVENLABS_VOICE_ID` - Voice selection
- Dodo Payments configured for subscriptions
